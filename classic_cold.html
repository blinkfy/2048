<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>2048</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #ebfdff;
      color: #044d48cb;
      font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
      font-size: 18px;
    }

    body {
      margin: 80px 0;
    }

    .heading:after {
      content: "";
      display: block;
      clear: both;
    }

    h1.title {
      font-size: 80px;
      font-weight: bold;
      margin: 0;
      display: block;
      float: left;
    }

    @-webkit-keyframes move-up {
      0% {
        top: 25px;
        opacity: 1;
      }

      100% {
        top: -50px;
        opacity: 0;
      }
    }

    @-moz-keyframes move-up {
      0% {
        top: 25px;
        opacity: 1;
      }

      100% {
        top: -50px;
        opacity: 0;
      }
    }

    @keyframes move-up {
      0% {
        top: 25px;
        opacity: 1;
      }

      100% {
        top: -50px;
        opacity: 0;
      }
    }

    .scores-container {
      float: right;
      text-align: right;
    }

    .score-container,
    .best-container {
      position: relative;
      display: inline-block;
      background: #00d6af;
      padding: 15px 25px;
      font-size: 25px;
      height: 25px;
      line-height: 47px;
      font-weight: bold;
      border-radius: 3px;
      color: white;
      margin-top: 8px;
      text-align: center;
    }

    .score-container:after,
    .best-container:after {
      position: absolute;
      width: 100%;
      top: 10px;
      left: 0;
      text-transform: uppercase;
      font-size: 13px;
      line-height: 13px;
      text-align: center;
      color: #daeeee;
    }

    .score-container .score-addition,
    .best-container .score-addition {
      position: absolute;
      right: 30px;
      color: rgba(0, 255, 200, 0.498);
      font-size: 25px;
      line-height: 25px;
      font-weight: bold;
      color: rgba(8, 254, 242, 0.457);
      z-index: 100;
      -webkit-animation: move-up 600ms ease-in;
      -moz-animation: move-up 600ms ease-in;
      animation: move-up 600ms ease-in;
      -webkit-animation-fill-mode: both;
      -moz-animation-fill-mode: both;
      animation-fill-mode: both;
    }

    .score-container:after {
      content: "ÂæóÂàÜ";
    }

    .best-container:after {
      content: "ÂéÜÂè≤ÊúÄ‰Ω≥";
    }

    p {
      margin-top: 0;
      margin-bottom: 10px;
      line-height: 1.65;
    }

    a {
      color: #074739;
      font-weight: bold;
      text-decoration: underline;
      cursor: pointer;
    }

    strong.important {
      text-transform: uppercase;
    }

    hr {
      border: none;
      border-bottom: 1px solid #007979;
      margin-top: 20px;
      margin-bottom: 30px;
    }

    .container {
      width: 500px;
      margin: 0 auto;
    }

    @-webkit-keyframes fade-in {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @-moz-keyframes fade-in {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    @keyframes fade-in {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .game-container {
      margin-top: 40px;
      position: relative;
      padding: 15px;
      cursor: default;
      -webkit-touch-callout: none;
      -ms-touch-callout: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -ms-touch-action: none;
      touch-action: none;
      background: #01918c;
      border-radius: 6px;
      width: 500px;
      height: 500px;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }

    .game-container .game-message {
      display: none;
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background: rgba(218, 238, 234, 0.5);
      z-index: 100;
      text-align: center;
      -webkit-animation: fade-in 800ms ease 1200ms;
      -moz-animation: fade-in 800ms ease 1200ms;
      animation: fade-in 800ms ease 1200ms;
      -webkit-animation-fill-mode: both;
      -moz-animation-fill-mode: both;
      animation-fill-mode: both;
    }

    .game-container .game-message p {
      font-size: 60px;
      font-weight: bold;
      height: 60px;
      line-height: 60px;
      margin-top: 222px;
    }

    .game-container .game-message .lower {
      display: block;
      margin-top: 59px;
    }

    .game-container .game-message a {
      display: inline-block;
      background: #bfeaf0;
      border-radius: 3px;
      padding: 0 20px;
      text-decoration: none;
      color: #f2f9f7;
      height: 40px;
      line-height: 42px;
      margin-left: 9px;
    }

    .game-container .game-message a.keep-playing-button {
      display: none;
    }

    .game-container .game-message.game-won {
      background: rgba(13, 112, 96, 0.5);
      color: #f9f6f2;
    }

    .game-container .game-message.game-won a.keep-playing-button {
      display: inline-block;
    }

    .game-container .game-message.game-won,
    .game-container .game-message.game-over {
      display: block;
    }

    .grid-container {
      position: absolute;
      z-index: 1;
    }

    .grid-row {
      margin-bottom: 15px;
    }

    .grid-row:last-child {
      margin-bottom: 0;
    }

    .grid-row:after {
      content: "";
      display: block;
      clear: both;
    }

    .grid-cell {
      width: 106.25px;
      height: 106.25px;
      margin-right: 15px;
      float: left;
      border-radius: 3px;
      background: rgba(0, 248, 210, 0.436);
    }

    .grid-cell:last-child {
      margin-right: 0;
    }

    .tile-container {
      position: absolute;
      z-index: 2;
    }

    .tile,
    .tile .tile-inner {
      width: 107px;
      height: 107px;
      line-height: 107px;
    }

    .tile.tile-position-1-1 {
      -webkit-transform: translate(0px, 0px);
      -moz-transform: translate(0px, 0px);
      -ms-transform: translate(0px, 0px);
      transform: translate(0px, 0px);
    }

    .tile.tile-position-1-2 {
      -webkit-transform: translate(0px, 121px);
      -moz-transform: translate(0px, 121px);
      -ms-transform: translate(0px, 121px);
      transform: translate(0px, 121px);
    }

    .tile.tile-position-1-3 {
      -webkit-transform: translate(0px, 242px);
      -moz-transform: translate(0px, 242px);
      -ms-transform: translate(0px, 242px);
      transform: translate(0px, 242px);
    }

    .tile.tile-position-1-4 {
      -webkit-transform: translate(0px, 363px);
      -moz-transform: translate(0px, 363px);
      -ms-transform: translate(0px, 363px);
      transform: translate(0px, 363px);
    }

    .tile.tile-position-2-1 {
      -webkit-transform: translate(121px, 0px);
      -moz-transform: translate(121px, 0px);
      -ms-transform: translate(121px, 0px);
      transform: translate(121px, 0px);
    }

    .tile.tile-position-2-2 {
      -webkit-transform: translate(121px, 121px);
      -moz-transform: translate(121px, 121px);
      -ms-transform: translate(121px, 121px);
      transform: translate(121px, 121px);
    }

    .tile.tile-position-2-3 {
      -webkit-transform: translate(121px, 242px);
      -moz-transform: translate(121px, 242px);
      -ms-transform: translate(121px, 242px);
      transform: translate(121px, 242px);
    }

    .tile.tile-position-2-4 {
      -webkit-transform: translate(121px, 363px);
      -moz-transform: translate(121px, 363px);
      -ms-transform: translate(121px, 363px);
      transform: translate(121px, 363px);
    }

    .tile.tile-position-3-1 {
      -webkit-transform: translate(242px, 0px);
      -moz-transform: translate(242px, 0px);
      -ms-transform: translate(242px, 0px);
      transform: translate(242px, 0px);
    }

    .tile.tile-position-3-2 {
      -webkit-transform: translate(242px, 121px);
      -moz-transform: translate(242px, 121px);
      -ms-transform: translate(242px, 121px);
      transform: translate(242px, 121px);
    }

    .tile.tile-position-3-3 {
      -webkit-transform: translate(242px, 242px);
      -moz-transform: translate(242px, 242px);
      -ms-transform: translate(242px, 242px);
      transform: translate(242px, 242px);
    }

    .tile.tile-position-3-4 {
      -webkit-transform: translate(242px, 363px);
      -moz-transform: translate(242px, 363px);
      -ms-transform: translate(242px, 363px);
      transform: translate(242px, 363px);
    }

    .tile.tile-position-4-1 {
      -webkit-transform: translate(363px, 0px);
      -moz-transform: translate(363px, 0px);
      -ms-transform: translate(363px, 0px);
      transform: translate(363px, 0px);
    }

    .tile.tile-position-4-2 {
      -webkit-transform: translate(363px, 121px);
      -moz-transform: translate(363px, 121px);
      -ms-transform: translate(363px, 121px);
      transform: translate(363px, 121px);
    }

    .tile.tile-position-4-3 {
      -webkit-transform: translate(363px, 242px);
      -moz-transform: translate(363px, 242px);
      -ms-transform: translate(363px, 242px);
      transform: translate(363px, 242px);
    }

    .tile.tile-position-4-4 {
      -webkit-transform: translate(363px, 363px);
      -moz-transform: translate(363px, 363px);
      -ms-transform: translate(363px, 363px);
      transform: translate(363px, 363px);
    }

    .tile {
      position: absolute;
      -webkit-transition: 100ms ease-in-out;
      -moz-transition: 100ms ease-in-out;
      transition: 100ms ease-in-out;
      -webkit-transition-property: -webkit-transform;
      -moz-transition-property: -moz-transform;
      transition-property: transform;
    }

    .tile .tile-inner {
      border-radius: 3px;
      background: #0a6b4e;
      text-align: center;
      font-weight: bold;
      z-index: 10;
      font-size: 55px;
    }

    .tile.tile-2 .tile-inner {
      background: #aaeaea;
      box-shadow: 0 0 30px 10px rgba(116, 243, 222, 0.447), inset 0 0 0 1px rgba(255, 255, 255, 0);
    }

    .tile.tile-4 .tile-inner {
      background: #c8e7ed;
      box-shadow: 0 0 30px 10px rgba(116, 243, 222, 0), inset 0 0 0 1px rgba(255, 255, 255, 0);
    }

    .tile.tile-8 .tile-inner {
      color: #f2f6f9;
      background: #79d4f2;
    }

    .tile.tile-16 .tile-inner {
      color: #f9f6f2;
      background: #63c2f5;
    }

    .tile.tile-32 .tile-inner {
      color: #f9f6f2;
      background: #5f91f6;
    }

    .tile.tile-64 .tile-inner {
      color: #f9f6f2;
      background: #3b5af6;
    }

    .tile.tile-128 .tile-inner {
      color: #f9f6f2;
      background: #8472ed;
      box-shadow: 0 0 30px 10px rgba(116, 243, 211, 0.4), inset 0 0 0 1px rgba(255, 255, 255, 0.756);
      font-size: 45px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-128 .tile-inner {
        font-size: 25px;
      }
    }

    .tile.tile-256 .tile-inner {
      color: #f9f6f2;
      background: #a761ed;
      box-shadow: 0 0 30px 10px rgba(116, 243, 243, 0.317), inset 0 0 0 1px rgba(255, 255, 255, 0.19048);
      font-size: 45px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-256 .tile-inner {
        font-size: 25px;
      }
    }

    .tile.tile-512 .tile-inner {
      color: #f9f6f2;
      background: #ae50ed;
      box-shadow: 0 0 30px 10px rgba(116, 243, 224, 0.397), inset 0 0 0 1px rgba(255, 255, 255, 0.238);
      font-size: 45px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-512 .tile-inner {
        font-size: 25px;
      }
    }

    .tile.tile-1024 .tile-inner {
      color: #f9f6f2;
      background: #8f26f9;
      box-shadow: 0 0 30px 10px rgba(196, 116, 243, 0.476), inset 0 0 0 1px rgba(255, 255, 255, 0.28571);
      font-size: 35px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-1024 .tile-inner {
        font-size: 15px;
      }
    }

    .tile.tile-2048 .tile-inner {
      color: #f9f6f2;
      background: #7e04b2;
      box-shadow: 0 0 30px 10px rgba(179, 116, 243, 0.556), inset 0 0 0 1px rgba(255, 255, 255, 0.33333);
      font-size: 35px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-2048 .tile-inner {
        font-size: 15px;
      }
    }

    .tile.tile-super .tile-inner {
      color: #f2f9f9;
      background: #ffffff;
      font-size: 30px;
    }

    @media screen and (max-width: 520px) {
      .tile.tile-super .tile-inner {
        font-size: 10px;
      }
    }

    @-webkit-keyframes appear {
      0% {
        opacity: 0;
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      100% {
        opacity: 1;
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    @-moz-keyframes appear {
      0% {
        opacity: 0;
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      100% {
        opacity: 1;
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    @keyframes appear {
      0% {
        opacity: 0;
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      100% {
        opacity: 1;
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    .tile-new .tile-inner {
      -webkit-animation: appear 200ms ease 100ms;
      -moz-animation: appear 200ms ease 100ms;
      animation: appear 200ms ease 100ms;
      -webkit-animation-fill-mode: backwards;
      -moz-animation-fill-mode: backwards;
      animation-fill-mode: backwards;
    }

    @-webkit-keyframes pop {
      0% {
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      50% {
        -webkit-transform: scale(1.2);
        -moz-transform: scale(1.2);
        -ms-transform: scale(1.2);
        transform: scale(1.2);
      }

      100% {
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    @-moz-keyframes pop {
      0% {
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      50% {
        -webkit-transform: scale(1.2);
        -moz-transform: scale(1.2);
        -ms-transform: scale(1.2);
        transform: scale(1.2);
      }

      100% {
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    @keyframes pop {
      0% {
        -webkit-transform: scale(0);
        -moz-transform: scale(0);
        -ms-transform: scale(0);
        transform: scale(0);
      }

      50% {
        -webkit-transform: scale(1.2);
        -moz-transform: scale(1.2);
        -ms-transform: scale(1.2);
        transform: scale(1.2);
      }

      100% {
        -webkit-transform: scale(1);
        -moz-transform: scale(1);
        -ms-transform: scale(1);
        transform: scale(1);
      }
    }

    .tile-merged .tile-inner {
      z-index: 20;
      -webkit-animation: pop 200ms ease 100ms;
      -moz-animation: pop 200ms ease 100ms;
      animation: pop 200ms ease 100ms;
      -webkit-animation-fill-mode: backwards;
      -moz-animation-fill-mode: backwards;
      animation-fill-mode: backwards;
    }

    .above-game:after {
      content: "";
      display: block;
      clear: both;
    }

    .game-intro {
      float: left;
      line-height: 42px;
      margin-bottom: 0;
    }

    .restart-button {
      display: inline-block;
      background: #68bbd9;
      border-radius: 3px;
      padding: 0 20px;
      text-decoration: none;
      color: #f9f6f2;
      height: 40px;
      line-height: 42px;
      display: block;
      text-align: center;
      float: right;
    }

    .game-explanation {
      margin-top: 50px;
    }

    /* Âπ≥ÊùøÂíåÂ∞èÂ±èÂπïÂìçÂ∫îÂºèÂ∏ÉÂ±Ä */
    @media screen and (max-width: 1024px) {
      /* Â∑¶Âè≥‰∏§ÂàóÊîπ‰∏∫ÂûÇÁõ¥ÊéíÂàó */
      div[style*="width:70%"],
      div[style*="width:350px"] {
        width: 100% !important;
        float: none !important;
        max-width: 100%;
      }

      /* Âè≥‰æßÊåâÈíÆÂÆπÂô®Â±Ö‰∏≠ */
      div[style*="width:350px"] > div[style*="float: right"] {
        float: none !important;
        text-align: center;
        margin: 20px auto;
        width: 100%;
      }

      /* ÂàáÊç¢‰∏ªÈ¢òÊåâÈíÆË∞ÉÊï¥ */
      .style-button {
        position: relative !important;
        margin: 0 10px !important;
        display: inline-block;
      }

      /* ÊéíË°åÊ¶úÂÆπÂô® */
      .leaderboard {
        float: none !important;
        margin: 20px auto;
        max-width: 500px;
      }

      /* ‰ø°ÊÅØÂç°Áâá */
      .info-card {
        margin: 20px auto;
      }
    }

    @media screen and (max-width: 520px) {

      html,
      body {
        font-size: 15px;
      }

      body {
        margin: 20px 0;
        padding: 0 20px;
      }

      h1.title {
        font-size: 27px;
        margin-top: 15px;
      }

      .container {
        width: 280px;
        margin: 0 auto;
      }

      .score-container,
      .best-container {
        margin-top: 0;
        padding: 15px 10px;
        min-width: 40px;
      }

      .heading {
        margin-bottom: 10px;
      }

      .game-intro {
        width: 55%;
        display: block;
        box-sizing: border-box;
        line-height: 1.65;
      }

      .restart-button {
        width: 42%;
        padding: 0;
        display: block;
        box-sizing: border-box;
        margin-top: 2px;
      }

      .game-container {
        margin-top: 17px;
        position: relative;
        padding: 10px;
        cursor: default;
        -webkit-touch-callout: none;
        -ms-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        -ms-touch-action: none;
        touch-action: none;
        background: #378ff3;
        border-radius: 6px;
        width: 280px;
        height: 280px;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

      .game-container .game-message {
        display: none;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(218, 238, 238, 0.5);
        z-index: 100;
        text-align: center;
        -webkit-animation: fade-in 800ms ease 1200ms;
        -moz-animation: fade-in 800ms ease 1200ms;
        animation: fade-in 800ms ease 1200ms;
        -webkit-animation-fill-mode: both;
        -moz-animation-fill-mode: both;
        animation-fill-mode: both;
      }

      .game-container .game-message p {
        font-size: 60px;
        font-weight: bold;
        height: 60px;
        line-height: 60px;
        margin-top: 222px;
      }

      .game-container .game-message .lower {
        display: block;
        margin-top: 59px;
      }

      .game-container .game-message a {
        display: inline-block;
        background: #cafefe;
        border-radius: 3px;
        padding: 0 20px;
        text-decoration: none;
        color: #f2f9f9;
        height: 40px;
        line-height: 42px;
        margin-left: 9px;
      }

      .game-container .game-message a.keep-playing-button {
        display: none;
      }

      .game-container .game-message.game-won {
        background: rgba(46, 237, 234, 0.5);
        color: #f9f6f2;
      }

      .game-container .game-message.game-won a.keep-playing-button {
        display: inline-block;
      }

      .game-container .game-message.game-won,
      .game-container .game-message.game-over {
        display: block;
      }

      .grid-container {
        position: absolute;
        z-index: 1;
      }

      .grid-row {
        margin-bottom: 10px;
      }

      .grid-row:last-child {
        margin-bottom: 0;
      }

      .grid-row:after {
        content: "";
        display: block;
        clear: both;
      }

      .grid-cell {
        width: 57.5px;
        height: 57.5px;
        margin-right: 10px;
        float: left;
        border-radius: 3px;
        background: rgb(255, 255, 255);
      }

      .grid-cell:last-child {
        margin-right: 0;
      }

      .tile-container {
        position: absolute;
        z-index: 2;
      }

      .tile,
      .tile .tile-inner {
        width: 58px;
        height: 58px;
        line-height: 58px;
      }

      .tile.tile-position-1-1 {
        -webkit-transform: translate(0px, 0px);
        -moz-transform: translate(0px, 0px);
        -ms-transform: translate(0px, 0px);
        transform: translate(0px, 0px);
      }

      .tile.tile-position-1-2 {
        -webkit-transform: translate(0px, 67px);
        -moz-transform: translate(0px, 67px);
        -ms-transform: translate(0px, 67px);
        transform: translate(0px, 67px);
      }

      .tile.tile-position-1-3 {
        -webkit-transform: translate(0px, 135px);
        -moz-transform: translate(0px, 135px);
        -ms-transform: translate(0px, 135px);
        transform: translate(0px, 135px);
      }

      .tile.tile-position-1-4 {
        -webkit-transform: translate(0px, 202px);
        -moz-transform: translate(0px, 202px);
        -ms-transform: translate(0px, 202px);
        transform: translate(0px, 202px);
      }

      .tile.tile-position-2-1 {
        -webkit-transform: translate(67px, 0px);
        -moz-transform: translate(67px, 0px);
        -ms-transform: translate(67px, 0px);
        transform: translate(67px, 0px);
      }

      .tile.tile-position-2-2 {
        -webkit-transform: translate(67px, 67px);
        -moz-transform: translate(67px, 67px);
        -ms-transform: translate(67px, 67px);
        transform: translate(67px, 67px);
      }

      .tile.tile-position-2-3 {
        -webkit-transform: translate(67px, 135px);
        -moz-transform: translate(67px, 135px);
        -ms-transform: translate(67px, 135px);
        transform: translate(67px, 135px);
      }

      .tile.tile-position-2-4 {
        -webkit-transform: translate(67px, 202px);
        -moz-transform: translate(67px, 202px);
        -ms-transform: translate(67px, 202px);
        transform: translate(67px, 202px);
      }

      .tile.tile-position-3-1 {
        -webkit-transform: translate(135px, 0px);
        -moz-transform: translate(135px, 0px);
        -ms-transform: translate(135px, 0px);
        transform: translate(135px, 0px);
      }

      .tile.tile-position-3-2 {
        -webkit-transform: translate(135px, 67px);
        -moz-transform: translate(135px, 67px);
        -ms-transform: translate(135px, 67px);
        transform: translate(135px, 67px);
      }

      .tile.tile-position-3-3 {
        -webkit-transform: translate(135px, 135px);
        -moz-transform: translate(135px, 135px);
        -ms-transform: translate(135px, 135px);
        transform: translate(135px, 135px);
      }

      .tile.tile-position-3-4 {
        -webkit-transform: translate(135px, 202px);
        -moz-transform: translate(135px, 202px);
        -ms-transform: translate(135px, 202px);
        transform: translate(135px, 202px);
      }

      .tile.tile-position-4-1 {
        -webkit-transform: translate(202px, 0px);
        -moz-transform: translate(202px, 0px);
        -ms-transform: translate(202px, 0px);
        transform: translate(202px, 0px);
      }

      .tile.tile-position-4-2 {
        -webkit-transform: translate(202px, 67px);
        -moz-transform: translate(202px, 67px);
        -ms-transform: translate(202px, 67px);
        transform: translate(202px, 67px);
      }

      .tile.tile-position-4-3 {
        -webkit-transform: translate(202px, 135px);
        -moz-transform: translate(202px, 135px);
        -ms-transform: translate(202px, 135px);
        transform: translate(202px, 135px);
      }

      .tile.tile-position-4-4 {
        -webkit-transform: translate(202px, 202px);
        -moz-transform: translate(202px, 202px);
        -ms-transform: translate(202px, 202px);
        transform: translate(202px, 202px);
      }

      .tile .tile-inner {
        font-size: 35px;
      }

      .game-message p {
        font-size: 30px !important;
        height: 30px !important;
        line-height: 30px !important;
        margin-top: 90px !important;
      }

      .game-message .lower {
        margin-top: 30px !important;
      }
    }

        /* ÊâãÊú∫Á´ØÊåâÈíÆÂ∏ÉÂ±Ä */
      .btn-open-popup {
        padding: 8px 16px;
        font-size: 14px;
        margin: 5px;
      }

      .style-button {
        position: relative !important;
        margin: 5px !important;
        display: inline-block;
        padding: 8px 16px;
        font-size: 14px;
      }

      /* Theme-aligned control buttons */
      .controls-top-right .btn-open-popup,
      .controls-top-right .style-button {
        background: linear-gradient(180deg, #f3e8dc 0%, #e7d6c2 100%);
        border: 1px solid rgba(0,0,0,0.08);
        color: #5b4a3f;
        padding: 10px 14px;
        font-weight: 600;
        border-radius: 8px;
        box-shadow: 4px 4px 8px rgba(0,0,0,0.08), inset -2px -2px 6px rgba(255,255,255,0.7);
        transition: transform 120ms ease, box-shadow 160ms ease, background 120ms ease;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .controls-top-right .btn-open-popup:hover,
      .controls-top-right .style-button:hover {
        transform: translateY(-2px);
        box-shadow: 6px 8px 16px rgba(0,0,0,0.12), inset -1px -1px 3px rgba(255,255,255,0.6);
        background: linear-gradient(180deg, #f7efe2 0%, #ead8bf 100%);
      }

      .controls-top-right .btn-open-popup:active,
      .controls-top-right .style-button:active {
        transform: translateY(0);
        box-shadow: 2px 2px 6px rgba(0,0,0,0.06) inset;
        background: linear-gradient(180deg, #e9d9c4 0%, #dcc8ad 100%);

      }
    
    /*-------------------------------------------------------------------------------------------ÁôªÂΩïÂºπÁ™ó‚Üì*/
    .btn-open-popup {
      padding: 12px 24px;
      font-size: 18px;
      background-color: rgb(0, 169, 155);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .btn-open-popup:hover {
      background-color: #4caf50;
    }

    .overlay-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 9999;
    }

    .popup-box {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      width: 320px;
      text-align: center;
      opacity: 0;
      transform: scale(0.8);
      animation: fadeInUp 0.5s ease-out forwards;
    }

    .form-container {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      margin-bottom: 10px;
      font-size: 16px;
      color: #444444;
      text-align: left;
    }

    .form-input {
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }

    .btn-submit,
    .btn-close-popup {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .btn-submit {
      background-color: rgb(0, 151, 136);
      color: #fff;
    }

    .btn-close-popup {
      margin-top: 12px;
      background-color: #3ce7ab;
      color: #fff;
    }

    .btn-submit:hover,
    .btn-close-popup:hover {
      background-color: #4caf50;
    }

    /* ----------------------------Ê∑°ÂÖ•Ê∑°Âá∫Âä®ÁîªÁöÑÂÖ≥ÈîÆÂ∏ß */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* -------------------------------ÂºπÁ™óÂä®Áîª */
    .overlay-container.show {
      display: flex;
      opacity: 1;
    }


    /*-----------------------------------------------------------------------------------------------ÊéíË°åÊ¶ú‚Üì*/
    leaderboard,
    leaderboard::before,
    leaderboard::after {
      box-sizing: border-box;
    }

    /*--------------------
Leaderboard
--------------------*/
    .leaderboard {
      position: relative;
      top: 0%;
      left: 0%;
      transform: translate(-10%, 40%);
      width: 385px;
      height: 380px;
      background: linear-gradient(to bottom, #3a4b4d, #182623);
      border-radius: 10px;
      box-shadow: 10px 25px 30px rgba(9, 58, 62, 0.3);
    }

    .leaderboard h1 {
      font-size: 22px;
      color: #e1e1e1;
      padding: 12px 13px 1px;
    }

    .leaderboard h1 svg {
      width: 25px;
      height: 26px;
      position: relative;
      top: 3px;
      margin-right: 6px;
      vertical-align: baseline;
      padding: 0px 10px 0px 0px;
    }

    .leaderboard ol {
      counter-reset: leaderboard;
    }

    .leaderboard ol li {
      position: relative;
      z-index: 1;
      font-size: 18px;
      counter-increment: leaderboard;
      padding: 18px 10px 18px 50px;
      cursor: pointer;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      transform: translateZ(0) scale(1, 1);
    }

    .leaderboard ol li::before {
      /*-------------------------------Â∫èÂè∑*/
      content: counter(leaderboard);
      position: absolute;
      z-index: 2;
      top: 15px;
      left: 15px;
      width: 20px;
      height: 20px;
      line-height: 20px;
      color: #44c2a9;
      background: #fff;
      border-radius: 20px;
      text-align: center;
    }

    .leaderboard ol li mark {
      /*---------------------------------Áî®Êà∑Âêç*/
      position: absolute;
      z-index: 2;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 18px 10px 18px 50px;
      margin: 0;
      background: none;
      color: #193a2d;
      font-weight: bold;
    }

    .leaderboard ol li mark::before,
    .leaderboard ol li mark::after {
      /*-----------------------Â∞è‰∏âËßí*/
      content: "";
      position: absolute;
      z-index: 1;
      bottom: 25px;
      left: -9px;
      border-top: 0px solid #44c2b5;
      border-left: 10px solid transparent;
      transition: all 0.1s ease-in-out;
      opacity: 0;
    }

    .leaderboard ol li mark::after {
      /*-----------------------Â∞è‰∏âËßí*/
      left: 0;
      right: 49px;
      border-left: none;
      border-right: 10px solid transparent;
    }

    .leaderboard ol li small {
      /*------------------------------Êï∞ÂÄº*/
      position: relative;
      color: #004e46;
      z-index: 2;
      display: block;
      text-align: right;
      font-weight: bold;
    }

    .leaderboard ol li::after {
      content: "";
      position: absolute;
      z-index: 1;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #55faad;
      box-shadow: 0 3px 0 rgba(7, 64, 59, 0.568);
      transition: all 0.3s ease-in-out;
      opacity: 0;
    }

    .leaderboard ol li:nth-child(1) {
      background: #d5fdf0;
    }

    .leaderboard ol li:nth-child(1)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5px rgba(5, 81, 71, 0.589);
    }

    .leaderboard ol li:nth-child(1) mark::before,
    .leaderboard ol li:nth-child(1) mark::after {
      border-top: 6px solid #3fad7d;
      bottom: 31px;
    }

    .leaderboard ol li:nth-child(2) {
      background: #bdf1e5;
    }

    .leaderboard ol li:nth-child(2)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5px rgba(0, 0, 0, 0.08);
    }

    .leaderboard ol li:nth-child(2) mark::before,
    .leaderboard ol li:nth-child(2) mark::after {
      border-top: 6px solid #3fad7d;
      bottom: 30px;
    }

    .leaderboard ol li:nth-child(3) {
      background: #a9e7cf;
    }

    .leaderboard ol li:nth-child(3)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5px rgba(0, 0, 0, 0.11);
    }

    .leaderboard ol li:nth-child(3) mark::before,
    .leaderboard ol li:nth-child(3) mark::after {
      border-top: 2px solid #3fad7d;
      bottom: 34px;
    }

    .leaderboard ol li:nth-child(4) {
      background: #9bdfcc;
    }

    .leaderboard ol li:nth-child(4)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5px rgba(0, 0, 0, 0.15);
    }

    .leaderboard ol li:nth-child(4) mark::before,
    .leaderboard ol li:nth-child(4) mark::after {
      top: -7px;
      bottom: auto;
      border-top: none;
      border-bottom: 6px solid #3fad7d;
    }

    .leaderboard ol li:nth-child(5) {
      background: #8ad3c2;
    }

    .leaderboard ol li:nth-child(5)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5pxx rgba(0, 0, 0, 0.12);
    }

    .leaderboard ol li:nth-child(5) mark::before,
    .leaderboard ol li:nth-child(5) mark::after {
      top: -9px;
      bottom: auto;
      border-top: none;
      border-bottom: 8px solid #3fad7d;
    }

    .leaderboard ol li:nth-child(6) {
      background: #7ac7b8;
      border-radius: 0 0 10px 10px;
    }

    .leaderboard ol li:nth-child(6)::after {
      background: #95e9c6;
      box-shadow: 0 5.5px 5px rgba(0, 0, 0, 0.12);
      border-radius: 0 0 10px 10px;
    }

    .leaderboard ol li:nth-child(6) mark::before,
    .leaderboard ol li:nth-child(6) mark::after {
      top: -9px;
      bottom: auto;
      border-top: none;
      border-bottom: 8px solid #3fad7d;
    }

    .leaderboard ol li:hover {
      z-index: 2;
      overflow: visible;
    }

    .leaderboard ol li:hover::after {
      opacity: 1;
      transform: scaleX(1.06) scaleY(1.03);
    }

    .leaderboard ol li:hover mark::before,
    .leaderboard ol li:hover mark::after {
      opacity: 1;
      transition: all 0.35s ease-in-out;
    }

    .the-most {
      position: fixed;
      z-index: 1;
      bottom: 0;
      left: 0;
      width: 50vw;
      max-width: 200px;
      padding: 10px;
    }

    .the-most img {
      max-width: 100%;
    }

    body,
    /*-----------------------------------------Âà†Èô§bodyÂêéÈ°µÈù¢ÊïàÊûú‰∏çÂêå*/
    ol,
    li,
    video {
      margin: 0;
      padding: 0;
      border: 0;
      font-size: 100%;
      font: inherit;
      vertical-align: baseline
    }

    ol,
    ul {
      list-style: none
    }

    .card-slot {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-right: 20px;
      padding: 15px;
      border: 2px dashed #bbb;
      background-color: #f9f9f9;
      border-radius: 10px;
      height: 40px;
      width: 100px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-top: 10px;
    }

    .half-card {
      padding: 10px 20px;
      background-color: #ffcc00;
      border: 2px solid #e6b800;
      border-radius: 5px;
      cursor: grab;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease;
    }

    .half-card:active {
      cursor: grabbing;
    }

    .half-card:hover {
      transform: scale(1.1);
    }

    @keyframes half-animation {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
      }
    }

    .tile {
      transition: background-color 0.2s, transform 0.2s;
    }

    .halfed {
      animation: half-animation 0.4s ease-in-out;
    }

    .blocked {
      animation: shake 0.4s ease-in-out;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-10px);
      }

      75% {
        transform: translateX(10px);
      }
    }

    .sig {
      width: 80px;
      height: 38px;
      border-radius: 10px;
      background-color: #7ec2b1;
      border-color: #fff;
      color: #ffffff;
      margin-top: 15px;
    }

    @keyframes wow {

      50% {
        color: white;
        text-shadow: 0px 0px 2px white;
      }

    }

    .info-card {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      font-size: 1.2rem;
      width: 100%;
      max-width: 500px;
      background: #52a3957a;
      border-radius: 0.7rem;
      padding: 3px;
      margin-top: 50px;
    }

    .info-card:hover {
      background-color: #e2fff6;
      /* Èº†Ê†áÊÇ¨ÂÅúÊó∂ÁöÑÈ¢úËâ≤ */
      color: rgb(226, 255, 251);
    }

    .info-card * {
      height: 100%;
      padding: 1rem 2px 1rem 2px;
      margin: 0;
      border-radius: .7rem;
    }

    .info-icon {
      align-self: center;
      border-top-right-radius: 3px;
      border-bottom-right-radius: 3px;
      background: #00ff9d6e;
      text-align: center;
      border-right: 1px solid #036647;
    }

    .info-text {
      flex: 1 1 0;
      text-align: center;
      background: #4fa08a7a;
      border-top-left-radius: 0px;
      border-bottom-left-radius: 0em;
      animation: 1.3s wow infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4fa080;
      font-family: sans-serif;
    }

    .style-button {
      display: inline-block;
      transition: all 0.2s ease-in;
      position: relative;
      overflow: hidden;
      z-index: 1;
      color: #090909;
      padding: 0.6em 1em;
      cursor: pointer;
      font-size: 18px;
      border-radius: 0.5em;
      background: #e8e8e8;
      border: 1px solid #e8e8e8;
      box-shadow: 6px 6px 12px #c5c5c5, -6px -6px 12px #ffffff;
    }

    .style-button:active {
      color: #666;
      box-shadow: inset 4px 4px 12px #c5c5c5, inset -4px -4px 12px #ffffff;
    }

    .style-button:before {
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%) scaleY(1) scaleX(1.25);
      top: 100%;
      width: 140%;
      height: 180%;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 50%;
      display: block;
      transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
      z-index: -1;
    }

    .style-button:after {
      content: "";
      position: absolute;
      left: 55%;
      transform: translateX(-50%) scaleY(1) scaleX(1.45);
      top: 180%;
      width: 160%;
      height: 190%;
      background-color: #009087;
      border-radius: 50%;
      display: block;
      transition: all 0.5s 0.1s cubic-bezier(0.55, 0, 0.1, 1);
      z-index: -1;
    }


    .style-button:hover {
      color: #ffffff;
      border: 1px solid #009087;
    }

    .style-button:hover:before {
      top: -35%;
      background-color: #009087;
      transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
    }

    .style-button:hover:after {
      top: -45%;
      background-color: #009087;
      transform: translateX(-50%) scaleY(1.3) scaleX(0.8);
    }

    /* Âõ∫ÂÆöÂè≥‰∏äËßíÁöÑÊéßÂà∂ÊåâÈíÆ */
    .controls-top-right {
      position: absolute;
      top: 16px;
      right: 16px;
      z-index: 1000;
      display: flex;
      gap: 8px;
      align-items: center;
      pointer-events: auto;
    }

    .controls-top-right .btn-open-popup,
    .controls-top-right .style-button {
      margin: 0;
    }

    /* Â∞èÂ±èÂπïÊó∂Á®çÂæÆÁº©Â∞èÂπ∂Â¢ûÂä†ÂèØÁÇπÈù¢ÁßØ */
    @media screen and (max-width: 520px) {
      .controls-top-right {
        top: 10px;
        right: 10px;
        gap: 6px;
      }

      .controls-top-right .btn-open-popup,
      .controls-top-right .style-button {
        padding: 8px 10px;
        font-size: 14px;
      }
    }
  </style>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport"
  content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">
</head>

<body>
<div style="height:100%;width:70%;float:left;">
  <input type="image" src="image/group.png" style="width: 160px;padding-top: 10px;" onclick="gohome()">
  <div class="container">
    <div class="heading">
      <img src="image/2048.png" style="width: 220px;">
      <div class="scores-container">
        <div class="score-container">0</div>
        <div class="best-container" id="bests">0</div>
      </div>
    </div>

  <!-- controls are placed in the right sidebar to match classic layout -->

    <!-- Êñ∞Â¢ûÂáèÂçäÂç°ÊßΩ -->
    <div class="card-slot" style="float: left;">
      <div class="half-card" draggable="true">ÂáèÂçäÂç°</div>
    </div><br />
    <span id="sign_in">Êú™ÁôªÂΩï</span>

    <div class="above-game">
      <p class="game-intro">Âø´Êù•Áé© <strong>2048Âêß!</strong></p>
      <a class="restart-button">ÈáçÊñ∞ÂºÄÂßã</a>
    </div>
    <div class="game-container">
      <div class="game-message">
        <p></p>
        <div class="lower">
          <a class="keep-playing-button">ÁªßÁª≠Ê∏∏Êàè</a>
          <a class="retry-button">ÂÜçÊù•‰∏ÄÊ¨°</a>
        </div>
      </div>

      <div class="grid-container">
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
      </div>

      <div class="tile-container">

      </div>
    </div>


    <p class="game-explanation">
      <strong class="important">Áé©Ê≥ïÊåáÂØº:</strong> ‰ΩøÁî® <strong>ÊñπÂêëÈîÆ/WASD/HJKLÈîÆ</strong> ÁßªÂä®ÊñπÂùó„ÄÇ ‰∏§‰∏™ÂêåÊ†∑Êï∞Â≠óÁöÑÊñπÂùóÁõ∏Á¢∞‰ºö
      <strong>ÂêàÂπ∂Êàê‰∏∫‰∏Ä‰∏™ÔºÅ</strong>
    </p>

  </div>
  <div id="popupOverlay" class="overlay-container">
    <div class="popup-box">
      <h2 style="color: green;">Áî®Êà∑ÁôªÂΩï</h2>
      <form class="form-container">
        <label class="form-label" for="name">
          Áî®Êà∑Âêç:
        </label>
        <input class="form-input" type="text" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" id="name" name="name" required>

        <label class="form-label" for="password">ÂØÜÁ†Å:</label>
        <input class="form-input" type="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" id="password" name="password" required>

        <button class="btn-submit" type="button" onclick="signin()">
          Á°ÆÂÆö
        </button>
      </form>

      <button class="btn-close-popup" onclick="togglePopup()">
        ÂÖ≥Èó≠
      </button>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
      <button type="primary" class="btn-close-popup" onclick="toRegister()">Ê≥®ÂÜå</button>
    </div>
  </div>
  <span id="debug"></span>
  </div>
  <div style="height:100%;width:350px;float:right;">
    <div class="controls-top-right">
      <button class="btn-open-popup" onclick="undo()">ÊÇîÊ£ã</button>
      <span class="style-button" onclick="theme()">ÂàáÊç¢‰∏ªÈ¢ò</span>
      <button class="btn-open-popup" onclick="togglePopup()"><div id="sibt">ÁôªÂΩï</div></button>
    </div>
    <div class="leaderboard" style="float: left;">
    <div onclick="ifunsign_Popup()">
      <h1>
        <svg class="ico-cup">
          <use xlink:href="#cup"></use>
        </svg>
        <span id="rank_title">ÁôªÂΩïÂêéÊü•ÁúãÊéíË°åÊ¶ú</span>
      </h1>
      <ol>
        <li>
          <mark id="rank1name">--------</mark>
          <small id="rank1num">----</small>
        </li>
        <li>
          <mark id="rank2name">--------</mark>
          <small id="rank2num">----</small>
        </li>
        <li>
          <mark id="rank3name">--------</mark>
          <small id="rank3num">----</small>
        </li>
        <li>
          <mark id="rank4name">--------</mark>
          <small id="rank4num">----</small>
        </li>
        <li>
          <mark id="rank5name">--------</mark>
          <small id="rank5num">----</small>
        </li>
        <li>
          <mark id="rank6name">--------</mark>
          <small id="rank6num">----</small>
        </li>
      </ol>
    </div>
    <div class="info-card" onclick="toMultiplayer()">
      <p class="info-icon">üì≤</p>
      <p class="info-text">‰∏Ä‰∏™‰∫∫Áé©Â§™Â≠§ÂçïÔºüÊù•ËØïËØïËÅîÊú∫Ê®°ÂºèÔºÅ</p>
    </div>
  </div>


  <svg style="display: none;">
    <symbol id="cup" x="0px" y="0px" width="25px" height="26px" viewBox="0 0 25 26" enable-background="new 0 0 25 26"
      xml:space="preserve">
      <path fill="#F26856" d="M21.215,1.428c-0.744,0-1.438,0.213-2.024,0.579V0.865c0-0.478-0.394-0.865-0.88-0.865H6.69
    C6.204,0,5.81,0.387,5.81,0.865v1.142C5.224,1.641,4.53,1.428,3.785,1.428C1.698,1.428,0,3.097,0,5.148
    C0,7.2,1.698,8.869,3.785,8.869h1.453c0.315,0,0.572,0.252,0.572,0.562c0,0.311-0.257,0.563-0.572,0.563
    c-0.486,0-0.88,0.388-0.88,0.865c0,0.478,0.395,0.865,0.88,0.865c0.421,0,0.816-0.111,1.158-0.303
    c0.318,0.865,0.761,1.647,1.318,2.31c0.686,0.814,1.515,1.425,2.433,1.808c-0.04,0.487-0.154,1.349-0.481,2.191
    c-0.591,1.519-1.564,2.257-2.975,2.257H5.238c-0.486,0-0.88,0.388-0.88,0.865v4.283c0,0.478,0.395,0.865,0.88,0.865h14.525
    c0.485,0,0.88-0.388,0.88-0.865v-4.283c0-0.478-0.395-0.865-0.88-0.865h-1.452c-1.411,0-2.385-0.738-2.975-2.257
    c-0.328-0.843-0.441-1.704-0.482-2.191c0.918-0.383,1.748-0.993,2.434-1.808c0.557-0.663,1-1.445,1.318-2.31
    c0.342,0.192,0.736,0.303,1.157,0.303c0.486,0,0.88-0.387,0.88-0.865c0-0.478-0.394-0.865-0.88-0.865
    c-0.315,0-0.572-0.252-0.572-0.563c0-0.31,0.257-0.562,0.572-0.562h1.452C23.303,8.869,25,7.2,25,5.148
    C25,3.097,23.303,1.428,21.215,1.428z M5.238,7.138H3.785c-1.116,0-2.024-0.893-2.024-1.99c0-1.097,0.908-1.99,2.024-1.99
    c1.117,0,2.025,0.893,2.025,1.99v2.06C5.627,7.163,5.435,7.138,5.238,7.138z M18.883,21.717v2.553H6.118v-2.553H18.883
    L18.883,21.717z M13.673,18.301c0.248,0.65,0.566,1.214,0.947,1.686h-4.24c0.381-0.472,0.699-1.035,0.947-1.686
    c0.33-0.865,0.479-1.723,0.545-2.327c0.207,0.021,0.416,0.033,0.627,0.033c0.211,0,0.42-0.013,0.627-0.033
    C13.195,16.578,13.344,17.436,13.673,18.301z M12.5,14.276c-2.856,0-4.93-2.638-4.93-6.273V1.73h9.859v6.273
    C17.43,11.638,15.357,14.276,12.5,14.276z M21.215,7.138h-1.452c-0.197,0-0.39,0.024-0.572,0.07v-2.06
    c0-1.097,0.908-1.99,2.024-1.99c1.117,0,2.025,0.893,2.025,1.99C23.241,6.246,22.333,7.138,21.215,7.138z" />
    </symbol>
  </svg>
</div>
<script>
  const tapAudio = new Audio('./audio/tap.mp3');
  let history = [];//ÂéÜÂè≤ËÆ∞ÂΩïÊ†à
  (function () {//Âä®ÁîªÂÖºÂÆπÊÄßÂ§ÑÁêÜ
    var lastTime = 0;
    var vendors = ['webkit', 'moz'];
    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
      window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
      window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||
        window[vendors[x] + 'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = function (callback) {
        var currTime = new Date().getTime();
        var timeToCall = Math.max(0, 16 - (currTime - lastTime));
        var id = window.setTimeout(function () {
          callback(currTime + timeToCall);
        },
          timeToCall);
        lastTime = currTime + timeToCall;
        return id;
      };
    }

    if (!window.cancelAnimationFrame) {
      window.cancelAnimationFrame = function (id) {
        clearTimeout(id);
      };
    }
  }());

  //Á≠âÂæÖÊµèËßàÂô®ÂáÜÂ§áÂ•ΩÊ∏≤ÊüìÊ∏∏ÊàèÔºàÈÅøÂÖçÂá∫Áé∞ÊïÖÈöúÔºâ
  window.requestAnimationFrame(function () {
    // addEvent(new GameManager(4, KeyboardInputManager, HTMLActuator, LocalStorageManager))
  });

  Function.prototype.bind = Function.prototype.bind || function (target) {//ÂáΩÊï∞ÁªëÂÆöÔºå‰ΩøÂæóÂú®Ë∞ÉÁî®Ëøô‰∏™Êñ∞ÂáΩÊï∞Êó∂ÔºåÂéüÂáΩÊï∞Ë¢´ÊåáÂÆöÁöÑÂØπË±°‰Ωú‰∏∫‰∏ä‰∏ãÊñáÊâßË°åÔºåÂπ∂‰∏îÂèØ‰ª•‰º†ÂÖ•È¢ÑËÆæÁöÑÂèÇÊï∞„ÄÇ
    var self = this;
    return function (args) {
      if (!(args instanceof Array)) {
        args = [args];
      }
      self.apply(target, args);
    };
  };

  (function () {//Âú®‰∏çÊîØÊåÅ classList Â±ûÊÄßÁöÑÊóßÁâàÊú¨ÊµèËßàÂô®‰∏≠ÔºåÊâãÂä®ÂÆûÁé∞ classList ÁöÑÂäüËÉΩ
    if (typeof window.Element === "undefined" ||
      "classList" in document.documentElement) {
      return;
    }

    var prototype = Array.prototype,
      push = prototype.push,
      splice = prototype.splice,
      join = prototype.join;

    function DOMTokenList(el) {
      this.el = el;
      // Á±ªÂêçÈúÄË¶ÅÂú®Á©∫Ê†ºÂ§ÑËøõË°å‰øÆÂâ™ÂíåÊãÜÂàÜ‰ª•Ê£ÄÁ¥¢Á±ªÁöÑÂàóË°®„ÄÇ
      var classes = el.className.replace(/^\s+|\s+$/g, '').split(/\s+/);
      for (var i = 0; i < classes.length; i++) {
        push.call(this, classes[i]);
      }
    }

    DOMTokenList.prototype = {
      add: function (token) {
        if (this.contains(token)) return;
        push.call(this, token);
        this.el.className = this.toString();
      },
      contains: function (token) {
        return this.el.className.indexOf(token) != -1;
      },
      item: function (index) {
        return this[index] || null;
      },
      remove: function (token) {
        if (!this.contains(token)) return;
        for (var i = 0; i < this.length; i++) {
          if (this[i] == token) break;
        }
        splice.call(this, i, 1);
        this.el.className = this.toString();
      },
      toString: function () {
        return join.call(this, ' ');
      },
      toggle: function (token) {
        if (!this.contains(token)) {
          this.add(token);
        } else {
          this.remove(token);
        }

        return this.contains(token);
      }
    };

    window.DOMTokenList = DOMTokenList;

    function defineElementGetter(obj, prop, getter) {
      if (Object.defineProperty) {
        Object.defineProperty(obj, prop, {
          get: getter
        });
      } else {
        obj.__defineGetter__(prop, getter);
      }
    }

    defineElementGetter(HTMLElement.prototype, 'classList', function () {
      return new DOMTokenList(this);
    });
  })();

  function GameManager(size, InputManager, Actuator, StorageManager) {
    this.size = size; // ÁΩëÊ†ºÁöÑÂ§ßÂ∞è
    this.inputManager = new InputManager; // new ËøêÁÆóÁ¨¶ÂÖÅËÆ∏ÂºÄÂèë‰∫∫ÂëòÂàõÂª∫‰∏Ä‰∏™Áî®Êà∑ÂÆö‰πâÁöÑÂØπË±°Á±ªÂûãÁöÑÂÆû‰æãÊàñÂÖ∑ÊúâÊûÑÈÄ†ÂáΩÊï∞ÁöÑÂÜÖÁΩÆÂØπË±°ÁöÑÂÆû‰æã„ÄÇ
    this.storageManager = new StorageManager;
    this.actuator = new Actuator;

    this.startTiles = 2; // ÂºÄÂßãÊó∂tileÁöÑÊï∞Èáè

    this.inputManager.on("move", this.move.bind(this)); // Ê≥®ÂÜåmoveÂõûË∞ÉÂáΩÊï∞
    /* Â¶ÇÊûú‰Ω†Êää this.move.bind(this) ‰∏≠ÁöÑ this ÊîπÊàê GameManagerÔºå‰ºöÂØºËá¥ÁªëÂÆöÂ§±Ë¥•Ôºå
    Âõ†‰∏∫ GameManager ‰∏çÊòØ‰∏Ä‰∏™ÂÆû‰æãÔºåËÄåÊòØ‰∏Ä‰∏™ÊûÑÈÄ†ÂáΩÊï∞„ÄÇÁªëÂÆöÊñπÊ≥ïÈúÄË¶ÅÂ∞Ü this ÁªëÂÆöÂà∞‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑÂØπË±°ÂÆû‰æãÔºå
    ËÄå‰∏çÊòØ‰∏Ä‰∏™Á±ªÔºàÊûÑÈÄ†ÂáΩÊï∞Ôºâ„ÄÇ*/
    this.inputManager.on("restart", this.restart.bind(this)); // Ê≥®ÂÜårestartÂõûË∞ÉÂáΩÊï∞
    this.inputManager.on("keepPlaying", this.keepPlaying.bind(this));  // Ê≥®ÂÜåkeepPlayingÂõûË∞ÉÂáΩÊï∞

    this.setup();
  }

  // Restart the game
  GameManager.prototype.restart = function () {
    this.storageManager.clearGameState();
    this.actuator.continueGame(); // Clear the game won/lost message
    this.setup();
  };

  // ÂΩì2048Ëµ¢‰∫Ü‰πãÂêéÔºåÊ∏∏ÊàèÁªßÁª≠
  GameManager.prototype.keepPlaying = function () {
    this.keepPlaying = true;
    this.actuator.continueGame(); // Clear the game won/lost message
  };

  // Âà§Êñ≠Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü ÁªìÊùü‚Äî‚Äî>true ÁªßÁª≠‚Äî‚Äî>false
  GameManager.prototype.isGameTerminated = function () {
    return this.over || (this.won && !this.keepPlaying);
  };

  // Set up the game
  GameManager.prototype.setup = function () {
    var previousState = this.storageManager.getGameState();

    // Reload the game from a previous game if present
    if (previousState) {
      this.grid = new Grid(previousState.grid.size,
        previousState.grid.cells); // Reload grid
      this.score = previousState.score;
      this.over = previousState.over;
      this.won = previousState.won;
      this.keepPlaying = previousState.keepPlaying;
    } else {
      this.grid = new Grid(this.size);
      this.score = 0;
      this.over = false;
      this.won = false;
      this.keepPlaying = false;

      while (history.length > 0) {
        history.pop();
      }
      // Ê∑ªÂä†ÂºÄÂßãÁöÑÊ†ºÂ≠êÔºåÊ†ºÂ≠êÊï∞ÈáèÁî±StartTilesÂÜ≥ÂÆö
      this.addStartTiles();
    }

    // Êõ¥Êñ∞ÁîªÈù¢
    this.actuate();
  };

  // Set up the initial tiles to start the game with
  GameManager.prototype.addStartTiles = function () {
    for (var i = 0; i < this.startTiles; i++) {
      this.addRandomTile();
    }
  };

  // Adds a tile in a random position
  GameManager.prototype.addRandomTile = function () {
    if (this.grid.cellsAvailable()) {
      var value = Math.random() < 0.9 ? 2 : 4;
      var tile = new Tile(this.grid.randomAvailableCell(), value);
      this.grid.insertTile(tile);
    }
  };

  // Sends the updated grid to the actuatorÊääÊõ¥Êñ∞ÁöÑgridÈÄÅÂà∞actuator
  GameManager.prototype.actuate = function () {
    if (this.storageManager.getBestScore() < this.score) {
      this.storageManager.setBestScore(this.score);
      if (username != "none") {//__________________________________________________________________xvyanfeiÂèëÈÄÅÊúÄÈ´òÂàÜÊï∞Âà∞ÊúçÂä°Âô®
        send("score=" + this.score + ",name=" + username + ";");
      }
      signscore = this.score;
    }

    // Â¶ÇÊûúÊ∏∏ÊàèÁªìÊùüÔºåÂàô‰∏çÂÜçÊõ¥Êñ∞actuatorÔºåÂà†Èô§Êï∞ÊçÆ(game over only, not win)
    if (this.over) {
      this.storageManager.clearGameState();
    } else {
      this.storageManager.setGameState(this.serialize());

    }

    this.actuator.actuate(this.grid, {
      score: this.score,
      over: this.over,
      won: this.won,
      bestScore: this.storageManager.getBestScore(),
      terminated: this.isGameTerminated()
    });

    // Êõ¥Êñ∞ÂæóÂàÜÊòæÁ§∫
    this.actuator.updateScore(this.score);
  };

  // Ê∏∏ÊàèÊï∞ÊçÆÊ†áÂáÜÂåñ
  GameManager.prototype.serialize = function () {
    return {
      grid: this.grid.serialize(),
      score: this.score,
      over: this.over,
      won: this.won,
      keepPlaying: this.keepPlaying
    };
  };

  //‰øùÂ≠òÊâÄÊúâtileÁöÑ‰ΩçÁΩÆÂπ∂Âà†Èô§ÂêàÂπ∂‰ø°ÊÅØ
  GameManager.prototype.prepareTiles = function () {
    this.grid.eachCell(function (x, y, tile) {
      if (tile) {
        tile.mergedFrom = null;
        tile.savePosition();
      }
    });
  };

  // ÁßªÂä®tileÂèäÂÖ∂Ë°®Á§∫ÔºåÊäätileÁßªÂä®Âà∞cell‰ΩçÁΩÆ‰∏ä
  GameManager.prototype.moveTile = function (tile, cell) {
    this.grid.cells[tile.x][tile.y] = null;
    this.grid.cells[cell.x][cell.y] = tile;
    tile.updatePosition(cell);
  };

  // ÊåâÊåáÂÆöÊñπÂêëÁßªÂä®ÊâÄÊúâtiles
  GameManager.prototype.move = function (direction) {
    // 0: up, 1: right, 2: down, 3: left
    var self = this;

    if (this.isGameTerminated()) return; // Don't do anything if the game's over

    var cell, tile;

    var vector = this.getVector(direction);
    var traversals = this.buildTraversals(vector);
    var moved = false;

    this.prepareTiles();// ‰øùÂ≠òÂΩìÂâçÂõæÂùó‰ΩçÁΩÆÂπ∂Âà†Èô§ÂêàÂπ∂‰ø°ÊÅØ

    // Ê≤øÊñπÂêëÈÅçÂéÜÁΩëÊ†ºÂπ∂ÁßªÂä®ÂõæÂùó
    traversals.x.forEach(function (x) {
      traversals.y.forEach(function (y) {                // Áõ∏ÂΩì‰∫é‰∏§Ê¨°Âæ™ÁéØÔºåÊØèÊ¨°Âæ™ÁéØÂêécellÈÉΩË¢´ËµãÂÄº
        cell = { x: x, y: y };                           // ËøôÈáåcell‰πüÁÆó‰øùÂ≠òÁùÄÂΩìÂâçÈÅçÂéÜÁöÑ‰ΩçÁΩÆ
        tile = self.grid.cellContent(cell);              // ËøîÂõû‰∏Ä‰∏™tileÂØπË±°

        if (tile) {
          var positions = self.findFarthestPosition(cell, vector);
          var next = self.grid.cellContent(positions.next);

          // Only one merger per row traversal?
          if (next && next.value === tile.value && !next.mergedFrom) {
            var merged = new Tile(positions.next, tile.value * 2); // Êää‰∏§‰∏™Áõ∏ÂêåÁöÑtileÂêàÂπ∂Êàê‰∏Ä‰∏™tile
            merged.mergedFrom = [tile, next]; // ËÆ∞ÂΩïÂêàÂπ∂ÁöÑ‰∏§‰∏™tile

            self.grid.insertTile(merged); // ÊèíÂÖ•ÂêàÂπ∂ÂêéÁöÑtileÔºåËøôÈáåÂØπÂ∫îÁöÑÂ∞±ÊòØÂú®ÂéüÊù•ÁöÑcellsÊï∞ÁªÑÈáåÈù¢Êîπ‰∫ÜËøô‰∏™‰ΩçÁΩÆÁöÑtile‰∫ÜÔºå‰∏çÈúÄË¶ÅËÄÉËôëtileÁöÑÂà†Èô§ÈóÆÈ¢ò
            self.grid.removeTile(tile); // Âà†Èô§ÂéüÊù•ÁöÑtile,ËøôÈáåÂà†Èô§ÁöÑÊòØcellsÊï∞ÁªÑÈáåÈù¢ÁöÑtileÔºåËÄåÂÆûÈôÖ‰∏äÁöÑtileÂØπË±°‰ªçÁÑ∂Â≠òÂú®ÔºåÂè™ÊòØ‰∏çÂÜçÊòæÁ§∫Âú®ÁïåÈù¢‰∏ä‰∫Ü

            // Áî±‰∫éÂÆûÈôÖ‰∏äÁöÑtileÂØπË±°‰ªçÁÑ∂Â≠òÂú®ÔºåËøôÈáåÊõ¥Êñ∞‰∫Ü‰ªñÁöÑ‰ΩçÁΩÆÔºå
            tile.updatePosition(positions.next);

            // Update the score
            self.score += merged.value;

            // The mighty 2048 tile
            if (merged.value === 2048) self.won = true;
          } else {
            self.moveTile(tile, positions.farthest);
          } // Â¶ÇÊûúÊ≤°ÊúâÂêàÂπ∂ÔºåÂàôÁßªÂä®tileÂà∞ÊúÄËøúË∑ùÁ¶ªÁöÑ‰ΩçÁΩÆ

          if (!self.positionsEqual(cell, tile)) {
            moved = true; // Áî±‰∫écell‰øùÂ≠òÁùÄÂΩìÂâçÈÅçÂéÜÁöÑ‰ΩçÁΩÆÔºåÊâÄ‰ª•Â¶ÇÊûúÁßªÂä®‰∫ÜÔºåÂàômoved‰∏∫true
          }
        }
      });
    });

    if (moved) {
      this.addRandomTile();

      if (!this.movesAvailable()) {
        this.over = true; // Game over!
      }

      this.actuate();
    }
  };

  // Get the vector representing the chosen direction
  GameManager.prototype.getVector = function (direction) {
    // Vectors representing tile movement
    var map = {
      0: { x: 0, y: -1 }, // Up
      1: { x: 1, y: 0 },  // Right
      2: { x: 0, y: 1 },  // Down
      3: { x: -1, y: 0 }   // Left
    };

    return map[direction];
  };

  // Build a list of positions to traverse in the right orderÂª∫Á´ã‰∏Ä‰∏™‰ª•Ê≠£Á°ÆÈ°∫Â∫èÈÅçÂéÜÁöÑ‰ΩçÁΩÆÂàóË°®
  GameManager.prototype.buildTraversals = function (vector) {
    var traversals = { x: [], y: [] };//ÈÅçÂéÜ‰ΩçÁΩÆÁöÑÊï∞ÁªÑ

    for (var pos = 0; pos < this.size; pos++) {
      traversals.x.push(pos);
      traversals.y.push(pos);
    }// Ëøô‰∏™ÈîÆÂÄºÂØπÔºåxÊòØ[0,1,2,3]Ôºåy‰πüÊòØ[0,1,2,3]

    // Ê†πÊçÆÊñπÂêëË∞ÉÊï¥ÈÅçÂéÜÈ°∫Â∫èÔºå‰ªéÊâÄÈÄâÊñπÂêë‰∏äÊúÄËøúÁöÑÂçïÂÖÉÊ†ºÂºÄÂßãÈÅçÂéÜ
    if (vector.x === 1) traversals.x = traversals.x.reverse();// Âè≥ÁßªÔºåxËΩ¥ÂèçÂêë
    if (vector.y === 1) traversals.y = traversals.y.reverse();

    return traversals;
  };

  GameManager.prototype.findFarthestPosition = function (cell, vector) {//ÂØªÊâæÁªôÂÆöÊñπÂêëÔºàvectorÔºâ‰∏äÊúÄËøúÁöÑÂèØÁßªÂä®‰ΩçÁΩÆ
    var previous;

    // ÊúùÁü¢ÈáèÊñπÂêëÂâçËøõÔºåÁõ¥Âà∞ÂèëÁé∞ÈöúÁ¢çÁâ©
    do {
      previous = cell;
      cell = { x: previous.x + vector.x, y: previous.y + vector.y };
    } while (this.grid.withinBounds(cell) && this.grid.cellAvailable(cell));         // ÁΩëÊ†ºËæπÁïåÂÜÖ‰∏îÊ≤°ÊúâÈöúÁ¢çÁâ©

    return {
      farthest: previous,
      next: cell // Used to check if a merge is required
    };
  };                                                 // ËøôÈáåÁöÑvectorÊñπÂêë‰∏∫‰∏ä‰∏ãÂ∑¶Âè≥ÔºåÊâÄ‰ª•Âè™‰ºöÊ£ÄÊµãÂêå‰∏ÄË°åÊàñËÄÖÂêå‰∏ÄÂàóÁöÑÊúÄËøúË∑ùÁ¶ª

  GameManager.prototype.movesAvailable = function () {              //Ê£ÄÊü•ÊòØÂê¶ÂèØÁßªÂä®
    return this.grid.cellsAvailable() || this.tileMatchesAvailable();
  };

  //Ê£ÄÊü•ÊòØÂê¶ÊúâtileÂèØÂêàÂπ∂ (more expensive check)
  GameManager.prototype.tileMatchesAvailable = function () {
    var self = this;

    var tile;

    for (var x = 0; x < this.size; x++) {
      for (var y = 0; y < this.size; y++) {
        tile = this.grid.cellContent({ x: x, y: y });

        if (tile) {
          for (var direction = 0; direction < 4; direction++) {// Âõõ‰∏™ÊñπÂêë‰∏äÈÉΩË¶ÅÊ£ÄÊü•ÊòØÂê¶ÊúâÁõ∏ÂêåÁöÑtile
            var vector = self.getVector(direction);
            var cell = { x: x + vector.x, y: y + vector.y }; // ËÆ°ÁÆó‰∏ã‰∏Ä‰∏™tileÁöÑ‰ΩçÁΩÆ

            var other = self.grid.cellContent(cell);

            if (other && other.value === tile.value) {
              return true; // These two tiles can be merged
            }
          }
        }
      }
    }

    return false;
  };

  GameManager.prototype.positionsEqual = function (first, second) {
    return first.x === second.x && first.y === second.y;
  };

  function Grid(size, previousState) {
    this.size = size;
    this.cells = previousState ? this.fromState(previousState) : this.empty();// Â¶ÇÊûúÊèê‰æõ‰∫ÜpreviousStateÔºåÂàô‰ªéÁä∂ÊÄÅ‰∏≠ÊûÑÂª∫ÁΩëÊ†ºÔºõÂê¶ÂàôÂàõÂª∫‰∏Ä‰∏™Á©∫ÁΩëÊ†º„ÄÇ
  }

  // Build a grid of the specified size
  Grid.prototype.empty = function () {
    var cells = [];
    for (var x = 0; x < this.size; x++) {
      var row = cells[x] = [];                   // Âè¶cells ‰∏∫‰∏Ä‰∏™‰∫åÁª¥Êï∞ÁªÑ
      for (var y = 0; y < this.size; y++) {
        row.push(null);                       //ÊØè‰∏Ä‰∏™ÂÖÉÁ¥†ÈÉΩÊòØ null„ÄÇjsÊòØÂºïÁî®‰º†ÈÄíÁöÑÔºårowÁöÑ‰øÆÊîπ‰ºöÁõ¥Êé•ÂΩ±ÂìçÂà∞cells
      }
    }
    return cells;
  };

  Grid.prototype.fromState = function (state) {//Ê†πÊçÆÁªôÂÆöÁöÑ state ÂàõÂª∫‰∏Ä‰∏™ size x size ÁöÑÁΩëÊ†ºÔºåÂÖ∂‰∏≠ÊØè‰∏™ÂçïÂÖÉÊ†ºÁöÑÂÄºÈÉΩÊòØ Tile ÂØπË±°/ null
    var cells = [];

    for (var x = 0; x < this.size; x++) {
      var row = cells[x] = [];

      for (var y = 0; y < this.size; y++) {
        var tile = state[x][y];
        row.push(tile ? new Tile(tile.position, tile.value) : null);//Êõ¥Êñ∞Êï∞ÊçÆ
      }
    }

    return cells;
  };

  // ÈöèÊú∫ÈÄâÂèñÁ¨¨‰∏Ä‰∏™Á©∫ÁôΩÂçïÂÖÉÊ†º
  Grid.prototype.randomAvailableCell = function () {
    var cells = this.availableCells();

    if (cells.length) {
      return cells[Math.floor(Math.random() * cells.length)];
    }
  };

  Grid.prototype.availableCells = function () {
    var cells = [];

    this.eachCell(function (x, y, tile) {// ÈÅçÂéÜÁΩëÊ†ºÔºåÂ∞ÜÁ©∫ÂçïÂÖÉÊ†ºÁöÑÂùêÊ†áÊ∑ªÂä†Âà∞ cells Êï∞ÁªÑ‰∏≠
      if (!tile) {
        cells.push({ x: x, y: y });
      }
    });

    return cells;
  };

  // ÈÅçÂéÜÁΩëÊ†ºÔºåÊâßË°åÂõûË∞ÉÂáΩÊï∞
  Grid.prototype.eachCell = function (callback) {
    for (var x = 0; x < this.size; x++) {
      for (var y = 0; y < this.size; y++) {
        callback(x, y, this.cells[x][y]);
      }
    }
  };

  // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÁ©∫ÁôΩÂçïÂÖÉÊ†º
  Grid.prototype.cellsAvailable = function () {
    return !!this.availableCells().length;//ÈÄöËøá!!ÂèØ‰ª•Á°Æ‰øùËøîÂõûÂÄºÊòØÂ∏ÉÂ∞îÁ±ªÂûã
  };

  // Ê£ÄÊü•ÂçïÂÖÉÊ†ºÊòØÂê¶ÂèØÁî®
  Grid.prototype.cellAvailable = function (cell) {
    return !this.cellOccupied(cell);
  };

  Grid.prototype.cellOccupied = function (cell) {
    return !!this.cellContent(cell);
  };

  Grid.prototype.cellContent = function (cell) {// Ëé∑ÂèñÊåáÂÆöÂçïÂÖÉÊ†ºÁöÑÂÜÖÂÆπ
    if (this.withinBounds(cell)) {//Âà§Êñ≠Âú®ËæπÁïåÂÜÖ
      return this.cells[cell.x][cell.y];
    } else {
      return null;
    }
  };

  // Âú®Áõ∏Â∫î‰ΩçÁΩÆÊèíÂÖ•‰∏Ä‰∏™tileÂÄº
  Grid.prototype.insertTile = function (tile) {
    this.cells[tile.x][tile.y] = tile;
  };

  Grid.prototype.removeTile = function (tile) {
    this.cells[tile.x][tile.y] = null;
  };

  Grid.prototype.withinBounds = function (position) {// ÊòØÂê¶Âú®ÁΩëÊ†ºÁöÑËæπÁïåÂÜÖ
    return position.x >= 0 && position.x < this.size &&
      position.y >= 0 && position.y < this.size;
  };

  Grid.prototype.serialize = function () {
    var cellState = [];

    for (var x = 0; x < this.size; x++) {
      var row = cellState[x] = [];

      for (var y = 0; y < this.size; y++) {
        row.push(this.cells[x][y] ? this.cells[x][y].serialize() : null);// ÂºïÁî®tileÂØπË±°ÁöÑserialize()ÊñπÊ≥ïÔºåÂ∞ÜÂÖ∂Â∫èÂàóÂåñ‰∏∫‰∏Ä‰∏™ÂØπË±°
      }
    }

    return {// ËøîÂõû‰∏Ä‰∏™ÂØπË±°ÔºåÂåÖÂê´ÁùÄÁΩëÊ†ºÁöÑsizeÂíå‰∏Ä‰∏™‰∫åÁª¥Êï∞ÁªÑÔºåËøô‰∏™Êï∞ÁªÑÁöÑÊØè‰∏™ÂÖÉÁ¥†ÈÉΩÊúâÁùÄÂΩìÂâçÁöÑpositionÂíåvalue
      size: this.size,
      cells: cellState
    };
  };

  function HTMLActuator() {
    this.tileContainer = document.querySelector(".tile-container");
    this.scoreContainer = document.querySelector(".score-container");
    this.bestContainer = document.querySelector(".best-container");
    this.messageContainer = document.querySelector(".game-message");

    this.score = 0;
    this.lastScore = 0; // Ê∑ªÂä† lastScore Â±ûÊÄß
  }

  HTMLActuator.prototype.actuate = function (grid, metadata) {
    var self = this;

    window.requestAnimationFrame(function () {// Á°Æ‰øùÁïåÈù¢ÁöÑÊõ¥Êñ∞‰∏éÊµèËßàÂô®ÁöÑÁªòÂà∂ÂêåÊ≠•ÔºåÊèê‰æõÊõ¥Âπ≥ÊªëÁöÑÂä®ÁîªÊïàÊûú
      self.clearContainer(self.tileContainer);

      grid.cells.forEach(function (column) {
        column.forEach(function (cell) {
          if (cell) {
            self.addTile(cell);
          }
        });
      });

      self.updateScore(metadata.score);
      self.updateBestScore(metadata.bestScore);

      if (metadata.terminated) {
        if (metadata.over) {
          self.message(false); // You lose
        } else if (metadata.won) {
          self.message(true); // You win!
        }
      }

    });
  };

  // Continues the game (both restart and keep playing)
  HTMLActuator.prototype.continueGame = function () {
    this.clearMessage();
  };

  HTMLActuator.prototype.clearContainer = function (container) {
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }
  };

  HTMLActuator.prototype.addTile = function (tile) {
    var self = this;

    var wrapper = document.createElement("div");
    var inner = document.createElement("div");
    var position = tile.previousPosition || { x: tile.x, y: tile.y };
    var positionClass = this.positionClass(position);

    // We can't use classlist because it somehow glitches when replacing classes
    var classes = ["tile", "tile-" + tile.value, positionClass];

    if (tile.value > 2048) classes.push("tile-super");

    this.applyClasses(wrapper, classes);

    inner.classList.add("tile-inner");
    inner.textContent = tile.value;

    if (tile.previousPosition) {
      // Make sure that the tile gets rendered in the previous position first
      window.requestAnimationFrame(function () {
        classes[2] = self.positionClass({ x: tile.x, y: tile.y });
        self.applyClasses(wrapper, classes); // Update the position
      });
    } else if (tile.mergedFrom) {
      classes.push("tile-merged");
      this.applyClasses(wrapper, classes);

      // Render the tiles that merged
      tile.mergedFrom.forEach(function (merged) {
        self.addTile(merged);
      });
    } else {
      classes.push("tile-new");
      this.applyClasses(wrapper, classes);
    }

    // Add the inner part of the tile to the wrapper
    wrapper.appendChild(inner);

    // Put the tile on the board
    this.tileContainer.appendChild(wrapper);
  };

  HTMLActuator.prototype.applyClasses = function (element, classes) {
    element.setAttribute("class", classes.join(" "));
  };

  HTMLActuator.prototype.normalizePosition = function (position) {
    return { x: position.x + 1, y: position.y + 1 };
  };

  HTMLActuator.prototype.positionClass = function (position) {
    position = this.normalizePosition(position);
    return "tile-position-" + position.x + "-" + position.y;
  };

  HTMLActuator.prototype.updateScore = function (score) {
    this.clearContainer(this.scoreContainer);
    var difference = score - this.lastScore;
    this.score = score;
    this.scoreContainer.textContent = this.score;
    if (difference > 0) {
      var addition = document.createElement("div");
      addition.classList.add("score-addition");
      addition.textContent = "+" + difference;
      this.scoreContainer.appendChild(addition);
    }
    // Êõ¥Êñ∞ lastScore ‰∏∫ÂΩìÂâçÂæóÂàÜÔºå‰ª•‰æø‰∏ãÊ¨°Ë∞ÉÁî®Êó∂ÂèØ‰ª•ËÆ°ÁÆóÂ∑ÆÂºÇ
    this.lastScore = score;
  };

  HTMLActuator.prototype.updateBestScore = function (bestScore) {
    this.bestContainer.textContent = bestScore;
  };

  HTMLActuator.prototype.message = function (won) {
    var type = won ? "game-won" : "game-over";
    var message = won ? "You win!" : "Game over!";

    this.messageContainer.classList.add(type);
    this.messageContainer.getElementsByTagName("p")[0].textContent = message;
  };

  HTMLActuator.prototype.clearMessage = function () {
    // IE only takes one value to remove at a time.
    this.messageContainer.classList.remove("game-won");
    this.messageContainer.classList.remove("game-over");
  };

  function KeyboardInputManager() {
    this.events = {};

    if (window.navigator.msPointerEnabled) {
      //Internet Explorer 10 style
      this.eventTouchstart = "MSPointerDown";
      this.eventTouchmove = "MSPointerMove";
      this.eventTouchend = "MSPointerUp";
    } else {
      this.eventTouchstart = "touchstart";
      this.eventTouchmove = "touchmove";
      this.eventTouchend = "touchend";
    }

    this.listen();
  }

  KeyboardInputManager.prototype.on = function (event, callback) {
    if (!this.events[event]) {
      this.events[event] = [];
    }
    this.events[event].push(callback);
  };

  KeyboardInputManager.prototype.emit = function (event, data) {
    var callbacks = this.events[event];
    if (callbacks) {
      callbacks.forEach(function (callback) {
        callback(data);
      });
    }
  };

  var loging = false;
  KeyboardInputManager.prototype.listen = function () {
    var self = this;

    var map = {
      38: 0, // Up
      39: 1, // Right
      40: 2, // Down
      37: 3, // Left
      75: 0, // Vim up
      76: 1, // Vim right
      74: 2, // Vim down
      72: 3, // Vim left
      87: 0, // W
      68: 1, // D
      83: 2, // S
      65: 3  // A
    };

    // Respond to direction keys
    document.addEventListener("keydown", function (event) {
      var modifiers = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;
      var mapped = map[event.which];

      if (!modifiers && !loging) {
        if (mapped !== undefined) {
          event.preventDefault();
          self.emit("move", mapped);
        }
      }

      // R key restarts the game
      if (!modifiers && event.which === 82 && !loging) {
        self.restart.call(self, event);
      }
    });

    // Respond to button presses
    this.bindButtonPress(".retry-button", this.restart);
    this.bindButtonPress(".restart-button", this.restart);
    this.bindButtonPress(".keep-playing-button", this.keepPlaying);

    // ÂìçÂ∫îÊªëÂä®‰∫ã‰ª∂ÔºàÊâãÊú∫Á´ØÔºâ
    var touchStartClientX, touchStartClientY;
    var gameContainer = document.getElementsByClassName("game-container")[0];

    gameContainer.addEventListener(this.eventTouchstart, function (event) {
      if ((!window.navigator.msPointerEnabled && event.touches.length > 1) ||
        event.targetTouches.length > 1) {
        return; // Ignore if touching with more than 1 finger
      }

      if (window.navigator.msPointerEnabled) {
        touchStartClientX = event.pageX;
        touchStartClientY = event.pageY;
      } else {
        touchStartClientX = event.touches[0].clientX;
        touchStartClientY = event.touches[0].clientY;
      }

      event.preventDefault();
    });

    gameContainer.addEventListener(this.eventTouchmove, function (event) {
      event.preventDefault();
    });

    gameContainer.addEventListener(this.eventTouchend, function (event) {
      if ((!window.navigator.msPointerEnabled && event.touches.length > 0) ||
        event.targetTouches.length > 0) {
        return; // Ignore if still touching with one or more fingers
      }

      var touchEndClientX, touchEndClientY;

      if (window.navigator.msPointerEnabled) {
        touchEndClientX = event.pageX;
        touchEndClientY = event.pageY;
      } else {
        touchEndClientX = event.changedTouches[0].clientX;
        touchEndClientY = event.changedTouches[0].clientY;
      }

      var dx = touchEndClientX - touchStartClientX;
      var absDx = Math.abs(dx);

      var dy = touchEndClientY - touchStartClientY;
      var absDy = Math.abs(dy);

      if (Math.max(absDx, absDy) > 10) {
        // (right : left) : (down : up)
        self.emit("move", absDx > absDy ? (dx > 0 ? 1 : 3) : (dy > 0 ? 2 : 0));
      }
    });
  };

  KeyboardInputManager.prototype.restart = function (event) {
    event.preventDefault();
    this.emit("restart");
  };

  KeyboardInputManager.prototype.keepPlaying = function (event) {
    event.preventDefault();
    this.emit("keepPlaying");
  };

  KeyboardInputManager.prototype.bindButtonPress = function (selector, fn) {
    var button = document.querySelector(selector);
    button.addEventListener("click", fn.bind(this));
    button.addEventListener(this.eventTouchend, fn.bind(this));
  };

  window.fakeStorage = {//Áî®‰∫éÂú®localStorateÂ§±ÊïàÊó∂Ê®°ÊãüÂÖ∂ÊïàÊûú
    _data: {},

    setItem: function (id, val) {
      return this._data[id] = String(val);
    },

    getItem: function (id) {
      return this._data.hasOwnProperty(id) ? this._data[id] : undefined;
    },

    removeItem: function (id) {
      return delete this._data[id];
    },

    clear: function () {
      return this._data = {};
    }
  };

  function LocalStorageManager() {
    this.bestScoreKey = "bestScore";
    this.gameStateKey = "gameState";

    var supported = this.localStorageSupported();
    this.storage = supported ? window.localStorage : window.fakeStorage;
  }

  LocalStorageManager.prototype.localStorageSupported = function () {//ÊµãËØïÊú¨Âú∞Â≠òÂÇ®ÊòØÂê¶ÂèØÁî®
    var testKey = "test";

    try {
      var storage = window.localStorage;
      storage.setItem(testKey, "1");
      storage.removeItem(testKey);
      return true;
    } catch (error) {
      return false;
    }
  };

  // Best score getters/setters
  LocalStorageManager.prototype.getBestScore = function () {
    return this.storage.getItem(this.bestScoreKey) || 0;
  };

  LocalStorageManager.prototype.setBestScore = function (score) {
    this.storage.setItem(this.bestScoreKey, score);
  };

  // Game state getters/setters and clearing
  LocalStorageManager.prototype.getGameState = function () {
    var stateJSON = this.storage.getItem(this.gameStateKey);
    //document.getElementById("debug").innerHTML = stateJSON;
    return stateJSON ? JSON.parse(stateJSON) : null;
  };

  LocalStorageManager.prototype.setGameState = function (gameState) {
    this.storage.setItem(this.gameStateKey, JSON.stringify(gameState));
    history.push(JSON.stringify(gameState));
  };

  LocalStorageManager.prototype.clearGameState = function () {
    this.storage.removeItem(this.gameStateKey);
  };

  function Tile(position, value) {
    this.x = position.x;
    this.y = position.y;
    this.value = value || 2;

    this.previousPosition = null;
    this.mergedFrom = null; // Ë∑üË∏™ÂêàÂπ∂Âú®‰∏ÄËµ∑ÁöÑ tile
  }

  Tile.prototype.savePosition = function () {
    this.previousPosition = { x: this.x, y: this.y };
  };

  Tile.prototype.updatePosition = function (position) {
    this.x = position.x;
    this.y = position.y;
  };

  Tile.prototype.serialize = function () {
    return {
      position: {
        x: this.x,
        y: this.y
      },
      value: this.value
    };
  };


  try {//__________________________________________________________________xvyanfei
    var username = decodeURIComponent(atob(getParameter("uid")));//‰ªé‰º†ÂèÇÂ∞ùËØïËß£ÊûêÁî®Êà∑Âêç
  }
  catch (err) {
    var username = "none"
  }
  if (username == "" || username != window.localStorage.getItem('username') || getDay() != window.localStorage.getItem('loginday')) {
    username = "none";
  }

  if (username != "none") {
    //ËøôÊó∂ÂÄôÂ∫îËØ•ÈóÆÊúçÂä°Âô®ÊòØÂê¶Ê≠£Á°Æ
    document.getElementById("sign_in").innerHTML = "Ê¨¢Ëøé " + username + ",";
    document.getElementById("sibt").innerHTML = "Â∑≤ÁôªÂΩï";
    document.getElementById("rank_title").innerHTML = "ÊéíË°åÊ¶ú";
    getRank();
    var stscore = parseInt(window.localStorage.getItem('bestScore') || 0);
    send("score=" + stscore + ",name=" + username + ";");
  }
  var signscore = 0;

  function getDay() {
    const now = new Date();
    const day = '.' + ('0' + now.getDate()).slice(-2);
    return day;
  }

  function send(retdata) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        return this.responseText;
      }
    };
    xhttp.open("POST", retdata, true);
    xhttp.send();
  }

  function togglePopup() {
    tapAudio.play();
    const overlay = document.getElementById('popupOverlay');
    overlay.classList.toggle('show');
    loging = !loging;
  }

  function toRegister() {
    window.location.href = "register.html?uid=" + btoa(encodeURIComponent(username));
  }

  function signin() {
    var nameVal = document.getElementById('name').value;
    var passwordVal = document.getElementById('password').value;
    var stscore = parseInt(window.localStorage.getItem('bestScore') || 0);
    if (nameVal == "" || passwordVal == "") {
      alert("ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†Å");
      return;
    }
    if (passwordVal.search(' ') != -1 || passwordVal.search(',') != -1 || passwordVal.search(';') != -1 || passwordVal.search('#') != -1 || passwordVal.search('=') != -1) {
      alert("ÂØÜÁ†ÅÈîôËØØ");
      return;
    } else if (nameVal.search(' ') != -1 || nameVal.search(',') != -1 || nameVal.search(';') != -1 || nameVal.search('#') != -1 || nameVal.search('=') != -1) {
      alert("ËØ•Áî®Êà∑Êú™Ê≥®ÂÜå");
      return;
    }
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var signback = this.responseText;
        if (signback.slice(0, 7) == "success") {
          document.getElementById("sign_in").innerHTML = "Ê¨¢Ëøé " + nameVal + ",";
          document.getElementById("sibt").innerHTML = "Â∑≤ÁôªÂΩï";
          document.getElementById("rank_title").innerHTML = "ÊéíË°åÊ¶ú";
          username = nameVal;
          getRank();
          togglePopup()
          signscore = Math.max(parseInt(signback.slice(7)), stscore);
          if (parseInt(signback.slice(7)) > stscore) {
            signscore = parseInt(signback.slice(7));
            stscore = signscore;
            window.localStorage.setItem('bestScore', signscore);
            document.getElementById("bests").innerHTML = stscore;
          }
          window.localStorage.setItem('username', username);
          window.localStorage.setItem('loginday', getDay());
        } else if (signback == "fail") {
          document.getElementById("sign_in").innerHTML = "Êú™ÁôªÂΩï";
          alert("ÂØÜÁ†ÅÈîôËØØ");
        } else if (signback == "unsign") {
          document.getElementById("sign_in").innerHTML = "Êú™ÁôªÂΩï";
          alert("ËØ•Áî®Êà∑Êú™Ê≥®ÂÜå");
        } else {
          document.getElementById("sign_in").innerHTML = signback;
        }
      }
    };
    xhttp.open("POST", "name=" + nameVal + ",password=" + passwordVal + ";", true);
    xhttp.send();
    send("score=" + stscore + ",name=" + nameVal + ";");
  }

  function ifunsign_Popup() {//---------ÁÇπÂáªÊéíË°åÊ¶úÂà§Êñ≠ÊòØÂê¶ÁôªÂΩï
    if (username == "none") {//Ë∑≥ËΩ¨ÁôªÂΩïÈ°µÈù¢
      togglePopup();
    } else {
      window.location.href = "ranklist.html?uid=" + btoa(encodeURIComponent(username));
    }
  }

  function toMultiplayer() {
    if (username == "none") {
      togglePopup();
    } else {
      tapAudio.play();
      window.location.href = "multiplayer.html?uid=" + btoa(encodeURIComponent(username));
    }
  }

  function gohome() {
    tapAudio.play();
    if (username == "none") {
      window.location.href = "home.html";
    } else {
      window.location.href = "home.html?uid=" + btoa(encodeURIComponent(username));
    }
  }

  function theme() {
    tapAudio.play();
    if (username == "none") {
      window.location.href = "classic.html";
    } else {
      window.location.href = "classic.html?uid=" + btoa(encodeURIComponent(username));
    }
  }

  function getRank() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var ranklist = this.responseText;
        document.getElementById("rank1name").innerHTML = decodeURIComponent(ranklist.slice(0, ranklist.indexOf(',')));
        var s = ranklist.slice(ranklist.indexOf(',') + 1);
        document.getElementById("rank1num").innerHTML = s.slice(0, s.indexOf('\n'));
        var s = s.slice(s.indexOf('\n') + 1);
        if (s.indexOf('\n') == -1) s = "--------,----\n--------,----\n--------,----\n--------,----\n--------,----\n";
        document.getElementById("rank2name").innerHTML = decodeURIComponent(s.slice(0, s.indexOf(',')));
        var s = s.slice(s.indexOf(',') + 1);
        document.getElementById("rank2num").innerHTML = s.slice(0, s.indexOf('\n'));
        var s = s.slice(s.indexOf('\n') + 1);
        if (s.indexOf('\n') == -1) s = "--------,----\n--------,----\n--------,----\n--------,----\n";
        document.getElementById("rank3name").innerHTML = decodeURIComponent(s.slice(0, s.indexOf(',')));
        var s = s.slice(s.indexOf(',') + 1);
        document.getElementById("rank3num").innerHTML = s.slice(0, s.indexOf('\n'));
        var s = s.slice(s.indexOf('\n') + 1);
        if (s.indexOf('\n') == -1) s = "--------,----\n--------,----\n--------,----\n";
        document.getElementById("rank4name").innerHTML = decodeURIComponent(s.slice(0, s.indexOf(',')));
        var s = s.slice(s.indexOf(',') + 1);
        document.getElementById("rank4num").innerHTML = s.slice(0, s.indexOf('\n'));
        var s = s.slice(s.indexOf('\n') + 1);
        if (s.indexOf('\n') == -1) s = "--------,----\n--------,----\n";
        document.getElementById("rank5name").innerHTML = decodeURIComponent(s.slice(0, s.indexOf(',')));
        var s = s.slice(s.indexOf(',') + 1);
        document.getElementById("rank5num").innerHTML = s.slice(0, s.indexOf('\n'));
        var s = s.slice(s.indexOf('\n') + 1);
        if (s.indexOf('\n') == -1) s = "--------,----\n";
        document.getElementById("rank6name").innerHTML = decodeURIComponent(s.slice(0, s.indexOf(',')));
        var s = s.slice(s.indexOf(',') + 1);
        document.getElementById("rank6num").innerHTML = s.slice(0, s.indexOf('\n'));
      }
    };
    xhttp.open("POST", "getrank=6;", true);
    xhttp.send();
  }

  function getParameter(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // ÊûÑÂª∫‰∏Ä‰∏™Âê´ÊúâÁõÆÊ†áÂèÇÊï∞ÁöÑÊ≠£ÂàôË°®ËææÂºèÂØπË±°
    var r = window.location.search.substr(1).match(reg); // ÂåπÈÖçÁõÆÊ†áÂèÇÊï∞
    if (r != null) {
      if (unescape(r[2]) == "null" || unescape(r[2]) == "none") {
        return "";
      }
      return unescape(r[2]);
    } else {
      return "";
    }
  }

  function undo() {
    // Ê£ÄÊü•ÊòØÂê¶ÊúâÂéÜÂè≤ËÆ∞ÂΩïÂèØ‰ª•ÂõûÈÄÄ
    if(username=="none"){
      alert("ÁôªÂΩïÂêé‰∫´ÊÇîÊ£ãÂäüËÉΩ");
      return;
    }
    if (history.length < 2) { // Ëá≥Â∞ëÈúÄË¶Å‰∏§‰∏™Áä∂ÊÄÅÊù•ËøõË°å‰∏ÄÊ¨°ÊúâÊïàÁöÑÊÇîÊ£ãÊìç‰Ωú
      alert("Ê≤°ÊúâÊõ¥Â§öÁöÑÊ≠•È™§ÂèØ‰ª•ÊÇîÊ£ã");
      return;
    }

    tapAudio.play();
    // ‰øùÂ≠òÂΩìÂâçÂæóÂàÜ
    var currentScore = gM.score;

    // ‰ªéÂéÜÂè≤ËÆ∞ÂΩï‰∏≠Âà†Èô§ÊúÄÂêé‰∏Ä‰∏™Áä∂ÊÄÅÔºàÂç≥ÂΩìÂâçÁä∂ÊÄÅÔºâ
    history.pop(); // ËøôÂ∞ÜÂà†Èô§ÂΩìÂâçÁä∂ÊÄÅÔºåÊâÄ‰ª•Êàë‰ª¨ÈÄÄÂõûÂà∞‰∫Ü‰∏ä‰∏ÄÊ≠•ÁöÑÁä∂ÊÄÅ

    // ÊÅ¢Â§çÂà∞‰πãÂâçÁöÑÁä∂ÊÄÅ
    var prevState = JSON.parse(history.pop());
    var grid = new Grid(prevState.grid.size, prevState.grid.cells);
    var score = prevState.score;
    var over = prevState.over;
    var won = prevState.won;

    // Êõ¥Êñ∞ GameManager ÂÆû‰æãÁöÑÁä∂ÊÄÅ
    gM.grid = grid;
    gM.score = score;
    gM.over = over;
    gM.won = won;

    // Êõ¥Êñ∞ÁïåÈù¢‰ª•ÂèçÊò†ÊÇîÊ£ãÂêéÁöÑÁä∂ÊÄÅ
    gM.actuate();

    // Â¶ÇÊûúÂΩìÂâçÂæóÂàÜÊØîÊÇîÊ£ãÂâçÁöÑÂæóÂàÜÈ´òÔºåÂàôÂõûÈÄÄÂæóÂàÜ
    if (currentScore > score) {
      // ËøôÈáåÊàë‰ª¨Áõ¥Êé•Êõ¥Êñ∞‰∫ÜÂæóÂàÜÔºåËÄå‰∏çÊòØÈÄöËøá actuatorÔºå
      // Âõ†‰∏∫Êàë‰ª¨Â∑≤ÁªèÈÄöËøá actuate() Êõ¥Êñ∞‰∫ÜÁïåÈù¢
      gM.score = score;
      gM.actuator.updateScore(gM.score); // Á°Æ‰øùÂæóÂàÜÊòæÁ§∫ÊòØÊúÄÊñ∞ÁöÑ
    }
  }

  //var array = encodeURIComponent("hello123!@#");      utf-8ÂíåÂ≠óÁ¨¶‰∏≤‰∫íËΩ¨
  //alert(array);
  //var content = decodeURIComponent(array);
  //alert(content);
  function addEvent(GameManager) {
    document.addEventListener("DOMContentLoaded", function () {
      console.log("start")
      const halfCard = document.querySelector(".half-card");

      halfCard.addEventListener("dragstart", function (e) {
        e.dataTransfer.setData("abcd", "half-card");
        e.dataTransfer.dropEffect = "move";
      });

      const tilesContainer = document.querySelector(".tile-container");

      tilesContainer.addEventListener("dragover", function (e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
      });

      tilesContainer.addEventListener("drop", function (e) {
        e.preventDefault();
        const data = e.dataTransfer.getData("abcd");
        console.log(data)
        if (data === "half-card") {
          const tile = e.target.closest(".tile-inner");
          const arr = e.target.parentNode.className.split("position-")[1].substring(0, 3).split("-")
          if (tile) {
            const tileValue = parseInt(tile.textContent);
            if (tileValue > 2) {
              tapAudio.play();
              const newValue = tileValue / 2;
              console.log(GameManager.grid.cells[parseInt(arr[0] - 1)][parseInt(arr[1] - 1)])
              GameManager.grid.cells[parseInt(arr[0] - 1)][parseInt(arr[1] - 1)].value = newValue
              console.log(GameManager.grid.cells[parseInt(arr[0] - 1)][parseInt(arr[1] - 1)])
              GameManager.prepareTiles()
              GameManager.actuate()
              // GameManager.storageManager.setGameState()
              updateTileValue(tile, newValue);
            }
          }
        }
      });

      function updateTileValue(tile, value) {
        tile.textContent = value;
        tile.classList.remove(`tile-${value * 2}`);
        tile.classList.add(`tile-${value}`);
      }
    });
  }
  </script>
  <script lang="js">
    var gM=new GameManager(4, KeyboardInputManager, HTMLActuator, LocalStorageManager);
    addEvent(gM);
  </script>
</body>

</html>